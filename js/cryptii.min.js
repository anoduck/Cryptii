//
// Cryptii
// 2014-10-28
//
var Cryptii=Cryptii||{};jQuery(function(){"use strict";new Cryptii.Application});var Cryptii=Cryptii||{};!function(a){"use strict";var b=function(){this._init.apply(this,arguments)};a.Application=b,b.prototype._init=function(){this._deckView=new a.DeckView,this._conversation=new a.Conversation(this._deckView),this._conversation.setBlocks([84,104,101,32,113,117,105,99,107,32,98,114,111,119,110,32,102,111,120,32,106,117,109,112,115,32,111,118,101,114,32,49,51,32,108,97,122,121,32,100,111,103,115,46]),this._conversation.addFormat(new a.TextFormat),this._conversation.addFormat(new a.DecimalFormat),this._conversation.addFormat(new a.DecimalFormat),this._conversation.addFormat(new a.BinaryFormat),this._conversation.addFormat(new a.HexadecimalFormat),this._conversation.addFormat(new a.OctalFormat)}}(Cryptii,jQuery);var Cryptii=Cryptii||{};!function(a){"use strict";var b=function(){this._init.apply(this,arguments)};a.Conversation=b,b.prototype._init=function(a){this._deckView=a,this._formats=[],this._blocks=[],this._difference=[]},b.prototype.addFormat=function(b){b instanceof a.Format&&-1===this._formats.indexOf(b)&&(this._formats.push(b),b.setConversation(this),b.convert(this,this._blocks,this._calculateDifference(this._blocks)),this._deckView.addCardView(b.getCardView()))},b.prototype.setBlocks=function(a,b){var c=this._calculateDifference(a,this._blocks);if(null!==c){this._blocks=a;for(var d=0;d<this._formats.length;d++)this._formats[d]!==b&&this._formats[d].convert(this,this._blocks,c);this._difference=c}},b.prototype._calculateDifference=function(b,c){var d=b.length,e=0,f=0;if(null!==c&&void 0!==c){for(d=Math.min(c.length,d);d>e&&c[e]==b[e];)e++;for(;d-e>f&&c[c.length-f-1]===b[b.length-f-1];)f++;if(0==f&&e==d-1&&c.length==b.length&&c[e]==b[e])return null}for(var g=[],h=e;h<b.length-f;h++)g.push(b[h]);return new a.Difference(e,f,g)},b.prototype.onFormatContentChange=function(a,b){this.setBlocks(b,a)},b.prototype.onFormatRemove=function(a){var b=this._formats.indexOf(a);-1!==b&&this._formats.splice(b,1)}}(Cryptii,jQuery);var Cryptii=Cryptii||{};!function(a){"use strict";var b=function(){this._init.apply(this,arguments)};a.Difference=b,b.prototype._init=function(a,b,c){this._startOffset=a,this._endOffset=b,this._blocks=c},b.prototype.getStartOffset=function(){return this._startOffset},b.prototype.getEndOffset=function(){return this._endOffset},b.prototype.getBlocks=function(){return this._blocks}}(Cryptii,jQuery);var Cryptii=Cryptii||{};!function(a){"use strict";var b=function(){this._init.apply(this,arguments)};a.Format=b,b.prototype._init=function(){this._cardView=null,this._conversation=null,this._options={}},b.prototype.getTitle=function(){return"Untitled"},b.prototype.interpret=function(){return[]},b.prototype.convert=function(){},b.prototype.onComposerViewChange=function(a,b){var c=(new Date).getTime(),d=this.interpret(b);this._conversion.onFormatContentChange(this,d);var e=(new Date).getTime()-c;console.log("Time: "+e+"ms")},b.prototype.onComposerViewSelect=function(){},b.prototype.onCardViewClose=function(){this._conversion.onFormatRemove(this)},b.prototype.setConversation=function(a){this._conversion=a},b.prototype.getCardView=function(){return this._cardView},b.prototype.getComposerView=function(){return this.getCardView().getComposerView()},b.prototype.getHighlighterElement=function(){return this.getCardView().getComposerView().getHighlighterElement()},b.prototype.getOptionValue=function(a){return this._options[a].getValue()},b.prototype.hasOptions=function(){var a=0;for(name in this._options)a++;return 0!==a},b.prototype.getOptions=function(){return this._options}}(Cryptii,jQuery);var Cryptii=Cryptii||{};!function(a){"use strict";var b=function(){this._init.apply(this,arguments)};a.Option=b,b.prototype._init=function(a,b){this._label=a,this._value=b,this._optionView=null},b.prototype.getLabel=function(){return this._label},b.prototype.isValueValid=function(){return!0},b.prototype.getValue=function(){return this._value},b.prototype.setValue=function(a){return this.isValueValid(a)?(this._value=a,!0):!1},b.prototype.getOptionView=function(){return this._optionView}}(Cryptii,jQuery);var Cryptii=Cryptii||{};!function(a){"use strict";var b=function(){this._init.apply(this,arguments)};a.Range=b,b.prototype._init=function(a,b){this._start=a,this._end=b},b.prototype.getStart=function(){return this._start},b.prototype.getLength=function(){return this._end-this._start},b.prototype.getEnd=function(){return this._end},b.prototype.isEqualTo=function(a){return null!=a&&a.getStart()==this.getStart()&&a.getEnd()==this.getEnd()}}(Cryptii,jQuery);var Cryptii=Cryptii||{};!function(a,b){"use strict";var c=function(){this._init.apply(this,arguments)};a.View=c,c.prototype._init=function(){this._$element=null},c.prototype._build=function(){var a=b("<div></div>");return a},c.prototype.getElement=function(){return null===this._$element&&(this._$element=this._build()),this._$element},c.prototype.forceRepaint=function(){var a=this._$element[0];a.style.display="none",a.offsetHeight,a.style.display=""}}(Cryptii,jQuery),function(a,b){"use strict";var c=a.Format,d=function(){this._init.apply(this,arguments)};d.prototype=Object.create(c.prototype),a.TextFormat=d,d.prototype._init=function(){c.prototype._init.apply(this,arguments),this._cardView=new a.TextFormatCardView(this),this._blockMeta=[]},d.prototype.getTitle=function(){return"Text"},d.prototype._getSeparator=function(){return null},d.prototype._getSeparatorLength=function(){return null!==this._getSeparator()?this._getSeparator().length:0},d.prototype.createBlockElement=function(a,c){return b(null!==a?"<b></b>":"<i></i>").text(c)},d.prototype.createSeparatorElement=function(){var a=this._getSeparator();return null===a?null:b("<u>"+a+"</u>")},d.prototype.interpretBlock=function(a){return a.charCodeAt(0)},d.prototype.convertBlock=function(a){return String.fromCharCode(a)},d.prototype.blockRangeByContentRange=function(b){for(var c=this._getSeparatorLength(),d=0,e=0,f=null;d<this._blockMeta.length&&e<b.getEnd();)d+=1,e+=this._blockMeta[d].content.length+c,null===f&&e>b.getStart()&&(f=d);return new a.Range(f,d)},d.prototype.contentRangeByBlockRange=function(b){for(var c=this._getSeparatorLength(),d=0,e=null,f=0;f<b.getEnd();f++)d+=this._blockMeta[f].content.length+c,f==b.getStart()&&(e=d);return new a.Range(e,d)},d.prototype.interpret=function(a){var b=this._getSeparator(),c=this.getHighlighterElement();c.empty();for(var d=[],e=[],f=null===b?a:a.split(b),g=0;g<f.length;g++){var h=f[g],i=this.interpretBlock(h),j=this.createBlockElement(i,h),k=this.createSeparatorElement();c.append(j,k),e.push(i),d.push({content:""+h,element:j,separatorElement:k})}return this._blockMeta=d,e},d.prototype.convert=function(a,b,c){var d=this._getSeparator(),e=this._getSeparatorLength(),f=this.getComposerView(),g=this.getHighlighterElement(),h=f.getContent(),i=h,j=h;if(c.getStartOffset()!=this._blockMeta.length){for(var k=0,l=0;l<c.getStartOffset();l++)k+=this._blockMeta[l].content.length+e;i=h.substr(0,k)}if(c.getEndOffset()!=this._blockMeta.length){for(var m=h.length,l=0;l<c.getEndOffset();l++)m-=this._blockMeta[this._blockMeta.length-1-l].content.length+e;j=h.substr(m)}for(var n=i,l=this._blockMeta.length-c.getEndOffset()-1;l>=c.getStartOffset();l--)this._blockMeta[l].element.remove(),null!==this._blockMeta[l].separatorElement&&this._blockMeta[l].separatorElement.remove(),this._blockMeta.splice(l,1);for(var o=[],p=c.getBlocks(),l=0;l<p.length;l++){var q=c.getStartOffset()+l,r=p[l],s=this.convertBlock(r),t=this.createBlockElement(r,s),u=this.createSeparatorElement();n+=s,o.push(t[0]),null!==d&&(n+=d,o.push(u[0])),this._blockMeta.splice(q,0,{content:""+s,element:t,separatorElement:u})}if(c.getStartOffset()>0){var v=this._blockMeta[c.getStartOffset()-1],w=null!==v.separatorElement?v.separatorElement:v.element;w.after(o)}else g.prepend(o);n+=j,f.forceRepaint(),f.setContent(n)}}(Cryptii,jQuery),function(a){"use strict";var b=a.TextFormat,c=function(){this._init.apply(this,arguments)};c.prototype=Object.create(b.prototype),a.DecimalFormat=c,c.prototype._init=function(){b.prototype._init.apply(this,arguments),this._options.separator=new a.TextOption("Separator"," ")},c.prototype.getTitle=function(){return"Decimal"},c.prototype._getSeparator=function(){return this.getOptionValue("separator")},c.prototype.interpretBlock=function(a){return isNaN(a)?null:parseInt(a)},c.prototype.convertBlock=function(a){return a}}(Cryptii,jQuery),function(a){"use strict";var b=a.DecimalFormat,c=function(){this._init.apply(this,arguments)};c.prototype=Object.create(b.prototype),a.BinaryFormat=c,c.prototype.getTitle=function(){return"Binary"},c.prototype.interpretBlock=function(a){var b=parseInt(a,2);return isNaN(b)?null:b},c.prototype.convertBlock=function(a){return a.toString(2)}}(Cryptii,jQuery),function(a){"use strict";var b=a.DecimalFormat,c=function(){this._init.apply(this,arguments)};c.prototype=Object.create(b.prototype),a.HexadecimalFormat=c,c.prototype.getTitle=function(){return"Hexadecimal"},c.prototype.interpretBlock=function(a){var b=parseInt(a,16);return isNaN(b)?null:b},c.prototype.convertBlock=function(a){return a.toString(16)}}(Cryptii,jQuery),function(a){"use strict";var b=a.DecimalFormat,c=function(){this._init.apply(this,arguments)};c.prototype=Object.create(b.prototype),a.OctalFormat=c,c.prototype.getTitle=function(){return"Octal"},c.prototype.interpretBlock=function(a){var b=parseInt(a,8);return isNaN(b)?null:b},c.prototype.convertBlock=function(a){return a.toString(8)}}(Cryptii,jQuery);var Cryptii=Cryptii||{};!function(a,b){"use strict";var c=a.Option,d=function(){this._init.apply(this,arguments)};d.prototype=Object.create(c.prototype),a.TextOption=d,d.prototype._init=function(){c.prototype._init.apply(this,arguments),this._optionView=new a.TextOptionView(this)},d.prototype._buildContent=function(){return CardView.prototype._buildContent.apply(this).append(b("<input>").attr("type","text"))},d.prototype.validateValue=function(){return!0}}(Cryptii,jQuery),function(a,b){"use strict";var c=a.View,d=function(){this._init.apply(this,arguments)};d.prototype=Object.create(c.prototype),a.CardView=d,d.prototype._init=function(){c.prototype._init.apply(this,arguments),this._deckView=null},d.prototype._build=function(){var a=c.prototype._build.apply(this);return a.addClass("card").append(this._buildHeader(),this._buildContent()),a},d.prototype._buildHeader=function(){return b("<div></div>").addClass("header").append(this._buildRightToolbar())},d.prototype._buildRightToolbar=function(){return b("<div></div>").addClass("toolbar").addClass("right").append(b("<a></a>").attr({href:"javascript:void(0);"}).on("click",b.proxy(function(){this.close()},this)).addClass("item").addClass("close"))},d.prototype._buildContent=function(){return b("<div></div>").addClass("content")},d.prototype.setDeckView=function(a){this._deckView!==a&&(this._deckView=a,null===a&&this._onClose())},d.prototype.close=function(){null!==this._deckView&&this._deckView.removeCardView(this)},d.prototype.layout=function(){},d.prototype.tick=function(){},d.prototype._onClose=function(){}}(Cryptii,jQuery),function(a,b){"use strict";var c=a.View,d=function(){this._init.apply(this,arguments)};d.prototype=Object.create(c.prototype),a.ComposerView=d,d.prototype._init=function(a){c.prototype._init.apply(this,arguments),this._cardView=a,this._$highlighter=null,this._$textarea=null,this._lastKnownContent="",this._lastKnownSelection=null},d.prototype._build=function(){var a=c.prototype._build.apply(this);return this._$textarea=b("<textarea></textarea>").attr({spellcheck:"false"}).keyup(this._trackChanges.bind(this)),this._$highlighter=b("<div></div>").addClass("highlighter"),a.addClass("composer").append(this._$textarea,this._$highlighter),a.on("click",b.proxy(function(){this._$textarea.focus()},this)),a},d.prototype.layout=function(){var a=this._$highlighter.height()+50;this._$textarea.height(a)},d.prototype.tick=function(){this._trackChanges()},d.prototype._trackChanges=function(){var a=this.getContent(),b=this.getSelection();a!=this._lastKnownContent&&(this._lastKnownContent=a,this._cardView.onComposerViewChange(this,a),this.layout()),(null===b!=(null===this._lastKnownSelection)||null!==b&&!b.isEqualTo(this._lastKnownSelection))&&(this._lastKnownSelection=b,this._cardView.onComposerViewSelect(this,b))},d.prototype.getHighlighterElement=function(){return this.getElement(),this._$highlighter},d.prototype.getContent=function(){return this.getElement(),this._$textarea.val()},d.prototype.setContent=function(a){this.getElement(),this._$textarea.val(a),this._lastKnownContent=a,setTimeout(function(){this.layout()}.bind(this),1)},d.prototype.getSelection=function(){var b=this._$textarea[0],c=0,d=0;if("selectionStart"in b)c=b.selectionStart,d=b.selectionEnd;else{var e=document.selection.createRange();e.parentElement()==b&&(c=e.startOffset,d=e.endOffset)}return c!=d?new a.Range(c,d):null}}(Cryptii,jQuery),function(a,b){"use strict";var c=a.View,d=function(){this._init.apply(this,arguments)};d.prototype=Object.create(c.prototype),a.DeckView=d,d.prototype._init=function(){c.prototype._init.apply(this,arguments),this._MIN_COLUMN_WIDTH=400,this._COLUMN_MARGIN=30,this._TICK_INTERVAL=1e3,this._cardViews=[],this._columnCount=0,this._columnCardDistributeIndex=0,this._tickTimer=setInterval(this._tick.bind(this),this._TICK_INTERVAL),setTimeout(function(){this._$element.addClass("animated")}.bind(this),500)},d.prototype._build=function(){return this._$element=b("#deck"),b(window).resize(function(){this.layout()}.bind(this)),this.layout(),this._$element},d.prototype.layout=function(){var a=b(window).width(),c=Math.max(parseInt((a-this._COLUMN_MARGIN)/(this._MIN_COLUMN_WIDTH+this._COLUMN_MARGIN)),1);if(this._columnCount!=c){this._columnCount=c,this._columnCardDistributeIndex=0;for(var d=0;d<this._cardViews.length;d++)this._cardViews[d].getElement().detach();this.getElement().empty();for(var d=0;c>d;d++){var e=b("<div></div>").addClass("column");this.getElement().append(e)}this._distributeCardView(this._cardViews)}var f=parseInt((a-this._COLUMN_MARGIN)/c);this.getElement().children().width(f-this._COLUMN_MARGIN);for(var d=0;d<this._cardViews.length;d++)this._cardViews[d].layout()},d.prototype._distributeCardView=function(c){if(c instanceof a.CardView){var d=this._columnCardDistributeIndex++%this._columnCount,e=b(this.getElement().children().get(d));e.append(c.getElement())}else if("[object Array]"===Object.prototype.toString.call(c))for(var f=c,g=0;g<f.length;g++)this._distributeCardView(f[g])},d.prototype._redistributeCardViews=function(){this._columnCardDistributeIndex=0;for(var a=0;a<this._cardViews.length;a++)this._cardViews[a].getElement().detach();this._distributeCardView(this._cardViews)},d.prototype._tick=function(){for(var a=0;a<this._cardViews.length;a++)this._cardViews[a].tick()},d.prototype.addCardView=function(b){b instanceof a.CardView&&(b.setDeckView(this),this._cardViews.push(b),this._distributeCardView(b))},d.prototype.removeCardView=function(a){var b=this._cardViews.indexOf(a);-1!==b&&(a.setDeckView(null),a.getElement().detach(),this._cardViews.splice(b,1),this._redistributeCardViews())}}(Cryptii,jQuery),function(a,b){"use strict";var c=a.View,d=function(){this._init.apply(this,arguments)};d.prototype=Object.create(c.prototype),a.OptionView=d,d.prototype._init=function(a){c.prototype._init.apply(this,arguments),this._option=a},d.prototype._build=function(){var a=c.prototype._build.apply(this);return a.addClass("option").append(this._buildLabel(),this._buildField()),a},d.prototype._buildLabel=function(){return b("<label></label>").text(this._option.getLabel())},d.prototype._buildField=function(){return b("<div></div>").addClass("field")}}(Cryptii,jQuery),function(a,b){"use strict";var c=a.CardView,d=function(){this._init.apply(this,arguments)};d.prototype=Object.create(c.prototype),a.FormatCardView=d,d.prototype._init=function(a){c.prototype._init.apply(this,arguments),this._format=a},d.prototype._buildHeader=function(){return c.prototype._buildHeader.apply(this).append(b("<h3></h3>").addClass("format").text(this._format.getTitle()))},d.prototype._buildContent=function(){var a=c.prototype._buildContent.apply(this);if(this._format.hasOptions()){var d=b("<div></div>").addClass("options"),e=this._format.getOptions();for(var f in e){var g=e[f].getOptionView();d.append(g.getElement())}a.append(d)}return a},d.prototype.layout=function(){},d.prototype.tick=function(){},d.prototype._onClose=function(){this._format.onCardViewClose(this)}}(Cryptii,jQuery),function(a,b){"use strict";var c=a.OptionView,d=function(){this._init.apply(this,arguments)};d.prototype=Object.create(c.prototype),a.TextOptionView=d,d.prototype._buildField=function(){return c.prototype._buildField.apply(this).append(b("<input>"))}}(Cryptii,jQuery),function(a){"use strict";var b=a.FormatCardView,c=function(){this._init.apply(this,arguments)};c.prototype=Object.create(b.prototype),a.TextFormatCardView=c,c.prototype._init=function(){b.prototype._init.apply(this,arguments),this._composerView=null},c.prototype._buildContent=function(){return b.prototype._buildContent.apply(this).append(this.getComposerView().getElement())},c.prototype.layout=function(){b.prototype.layout.apply(this,arguments),this.getComposerView().layout()},c.prototype.tick=function(){b.prototype.tick.apply(this,arguments),this.getComposerView().tick()},c.prototype.onComposerViewChange=function(a,b){this._format.onComposerViewChange(a,b)},c.prototype.onComposerViewSelect=function(a,b){this._format.onComposerViewSelect(a,b)},c.prototype.getComposerView=function(){return null===this._composerView&&(this._composerView=new a.ComposerView(this)),this._composerView}}(Cryptii,jQuery);